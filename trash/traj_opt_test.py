import numpy as np
import matplotlib.pyplot as plt

q0 = 0
qf = 100
dt = 10

Q = np.array([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, 0, 0],

              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   1, -1, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,  -1, 2, -1, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, -1, 2, -1, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, -1, 2, -1, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, -1, 2, -1, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, -1, 2, -1, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, -1, 2, -1, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, -1, 2, -1, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, -1, 2, -1],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,   0, 0, 0, 0, 0, 0, 0, 0, -1, 1]])
c = np.array([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]).T

E = np.array([[-1, 1, 0, 0, 0, 0, 0, 0, 0, 0,   0, -dt, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, -1, 1, 0, 0, 0, 0, 0, 0, 0,   0, 0, -dt, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, -1, 1, 0, 0, 0, 0, 0, 0,   0, 0, 0, -dt, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, -1, 1, 0, 0, 0, 0, 0,   0, 0, 0, 0, -dt, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, -1, 1, 0, 0, 0, 0,   0, 0, 0, 0, 0, -dt, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, -1, 1, 0, 0, 0,   0, 0, 0, 0, 0, 0, -dt, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, -1, 1, 0, 0,   0, 0, 0, 0, 0, 0, 0, -dt, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, -1, 1, 0,   0, 0, 0, 0, 0, 0, 0, 0, -dt, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, -1, 1,   0, 0, 0, 0, 0, 0, 0, 0, 0, -dt],

              [1, 0, 0, 0, 0, 0, 0, 0, 0, 0,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 1,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,    1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,    0, 1, 0, 0, 0, 0, 0, 0, 0, 0],
              [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,    0, 0, 0, 0, 0, 0, 0, 0, 0, 1]])
d = np.array([[0, 0, 0, 0, 0, 0, 0, 0, 0, q0, qf, 0, 0, 0]]).T

A = np.block([[Q, E.T],[E, np.eye(14)]])
b = np.block([[-c],[d]])

sol = np.linalg.lstsq(A,b)
v = sol[0][10:20]
v_pad = np.insert(v, 0, 0, axis=0)
v_pad = np.delete(v_pad, -1, axis=0)
a = v - v_pad

t = np.arange(10)
plt.figure()
plt.plot(t*dt, sol[0][:10], 'bo')
plt.figure()
plt.plot(t*dt, a, 'bo-')
plt.show()